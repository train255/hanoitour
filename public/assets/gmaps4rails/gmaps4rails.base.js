((function(){var a;a={},a.triggerOldOnload=function(){if(typeof a.oldOnload=="function")return a.oldOnload()},a.loadMaps=function(){var b,c,d,e,f;f=[];for(b in a)e=a[b],d=b.search(/load/),d===-1?(c="load_"+b,f.push(a[c]())):f.push(void 0);return f},window.Gmaps=a,this.Gmaps4Rails=function(){function a(){this.map=null,this.serviceObject=null,this.visibleInfoWindow=null,this.userLocation=null,this.geolocationFailure=function(){return!1},this.callback=function(){return!1},this.customClusterer=function(){return!1},this.infobox=function(){return!1},this.jsTemplate=!1,this.default_map_options={id:"map",draggable:!0,detect_location:!1,center_on_user:!1,center_latitude:0,center_longitude:0,zoom:7,maxZoom:null,minZoom:null,auto_adjust:!0,auto_zoom:!0,bounds:[],raw:{}},this.default_markers_conf={title:"",picture:"",width:22,length:32,draggable:!1,do_clustering:!1,randomize:!1,max_random_distance:100,list_container:null,offset:0,raw:{}},this.markers=[],this.boundsObject=null,this.polygons=[],this.polylines=[],this.circles=[],this.markerClusterer=null,this.markerImages=[]}return a.prototype.initialize=function(){return this.serviceObject=this.createMap(),this.map=this.serviceObject,(this.map_options.detect_location===!0||this.map_options.center_on_user===!0)&&this.findUserLocation(this),this.resetSidebarContent()},a.prototype.findUserLocation=function(a){var b,c;return navigator.geolocation?(c=function(b){a.userLocation=a.createLatLng(b.coords.latitude,b.coords.longitude);if(a.map_options.center_on_user===!0)return a.centerMapOnUser()},b=function(){return a.geolocationFailure(!0)},navigator.geolocation.getCurrentPosition(c,b)):a.geolocationFailure(!1)},a.prototype.create_direction=function(){var a,b,c;return a=new google.maps.DirectionsRenderer,b=new google.maps.DirectionsService,a.setMap(this.serviceObject),this.direction_conf.display_panel&&a.setPanel(document.getElementById(this.direction_conf.panel_id)),a.setOptions({suppressMarkers:!1,suppressInfoWindows:!1,suppressPolylines:!1}),c={origin:this.direction_conf.origin,destination:this.direction_conf.destination,waypoints:this.direction_conf.waypoints,optimizeWaypoints:this.direction_conf.optimizeWaypoints,unitSystem:google.maps.DirectionsUnitSystem[this.direction_conf.unitSystem],avoidHighways:this.direction_conf.avoidHighways,avoidTolls:this.direction_conf.avoidTolls,region:this.direction_conf.region,travelMode:google.maps.DirectionsTravelMode[this.direction_conf.travelMode],language:"en"},b.route(c,function(b,c){if(c===google.maps.DirectionsStatus.OK)return a.setDirections(b)})},a.prototype.create_circles=function(){var a,b,c,d,e;d=this.circles,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(this.create_circle(a));return e},a.prototype.create_circle=function(a){var b;a===this.circles[0]&&(a.strokeColor!=null&&(this.circles_conf.strokeColor=a.strokeColor),a.strokeOpacity!=null&&(this.circles_conf.strokeOpacity=a.strokeOpacity),a.strokeWeight!=null&&(this.circles_conf.strokeWeight=a.strokeWeight),a.fillColor!=null&&(this.circles_conf.fillColor=a.fillColor),a.fillOpacity!=null&&(this.circles_conf.fillOpacity=a.fillOpacity));if(a.lat!=null&&a.lng!=null)return b=new google.maps.Circle({center:this.createLatLng(a.lat,a.lng),strokeColor:a.strokeColor||this.circles_conf.strokeColor,strokeOpacity:a.strokeOpacity||this.circles_conf.strokeOpacity,strokeWeight:a.strokeWeight||this.circles_conf.strokeWeight,fillOpacity:a.fillOpacity||this.circles_conf.fillOpacity,fillColor:a.fillColor||this.circles_conf.fillColor,clickable:a.clickable||this.circles_conf.clickable,zIndex:a.zIndex||this.circles_conf.zIndex,radius:a.radius}),a.serviceObject=b,b.setMap(this.serviceObject)},a.prototype.clear_circles=function(){var a,b,c,d,e;d=this.circles,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(this.clear_circle(a));return e},a.prototype.clear_circle=function(a){return a.serviceObject.setMap(null)},a.prototype.hide_circles=function(){var a,b,c,d,e;d=this.circles,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(this.hide_circle(a));return e},a.prototype.hide_circle=function(a){return a.serviceObject.setMap(null)},a.prototype.show_circles=function(){var a,b,c,d,e;d=this.circles,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(this.show_circle(this.circle));return e},a.prototype.show_circle=function(a){return a.serviceObject.setMap(this.serviceObject)},a.prototype.create_polygons=function(){var a,b,c,d,e;d=this.polygons,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(this.create_polygon(a));return e},a.prototype.create_polygon=function(a){var b,c,d,e,f,g,h,i,j,k,l,m;h=[];for(l=0,m=a.length;l<m;l++)g=a[l],e=this.createLatLng(g.lat,g.lng),h.push(e),g===a[0]&&(i=g.strokeColor||this.polygons_conf.strokeColor,j=g.strokeOpacity||this.polygons_conf.strokeOpacity,k=g.strokeWeight||this.polygons_conf.strokeWeight,c=g.fillColor||this.polygons_conf.fillColor,d=g.fillOpacity||this.polygons_conf.fillOpacity,b=g.clickable||this.polygons_conf.clickable);return f=new google.maps.Polygon({paths:h,strokeColor:i,strokeOpacity:j,strokeWeight:k,fillColor:c,fillOpacity:d,clickable:b,map:this.serviceObject}),a.serviceObject=f},a.prototype.replacePolylines=function(a){return this.destroy_polylines(),this.polylines=a,this.create_polylines(),this.adjustMapToBounds()},a.prototype.destroy_polylines=function(){var a,b,c,d;d=this.polylines;for(b=0,c=d.length;b<c;b++)a=d[b],a.serviceObject.setMap(null);return this.polylines=[]},a.prototype.create_polylines=function(){var a,b,c,d,e;d=this.polylines,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(this.create_polyline(a));return e},a.prototype.create_polyline=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;h=[];for(m=0,o=a.length;m<o;m++){d=a[m];if(d.coded_array!=null){c=new google.maps.geometry.encoding.decodePath(d.coded_array);for(n=0,p=c.length;n<p;n++)g=c[n],h.push(g)}else d===a[0]&&(i=d.strokeColor||this.polylines_conf.strokeColor,j=d.strokeOpacity||this.polylines_conf.strokeOpacity,k=d.strokeWeight||this.polylines_conf.strokeWeight,b=d.clickable||this.polylines_conf.clickable,l=d.zIndex||this.polylines_conf.zIndex),d.lat!=null&&d.lng!=null&&(e=this.createLatLng(d.lat,d.lng),h.push(e))}return f=new google.maps.Polyline({path:h,strokeColor:i,strokeOpacity:j,strokeWeight:k,clickable:b,zIndex:l}),a.serviceObject=f,f.setMap(this.serviceObject)},a.prototype.create_markers=function(){return this.createServiceMarkersFromMarkers(),this.clusterize()},a.prototype.createServiceMarkersFromMarkers=function(){var a,b,c,d,e,f,g,h;h=this.markers;for(d=f=0,g=h.length;f<g;d=++f)e=h[d],this.markers[d].serviceObject==null&&(a=this.markers[d].lat,c=this.markers[d].lng,this.markers_conf.randomize&&(b=this.randomize(a,c),a=b[0],c=b[1]),this.markers[d].serviceObject=this.createMarker({marker_picture:this.markers[d].picture?this.markers[d].picture:this.markers_conf.picture,marker_width:this.markers[d].width?this.markers[d].width:this.markers_conf.width,marker_height:this.markers[d].height?this.markers[d].height:this.markers_conf.length,marker_title:this.markers[d].title?this.markers[d].title:null,marker_anchor:this.markers[d].marker_anchor?this.markers[d].marker_anchor:null,shadow_anchor:this.markers[d].shadow_anchor?this.markers[d].shadow_anchor:null,shadow_picture:this.markers[d].shadow_picture?this.markers[d].shadow_picture:null,shadow_width:this.markers[d].shadow_width?this.markers[d].shadow_width:null,shadow_height:this.markers[d].shadow_height?this.markers[d].shadow_height:null,marker_draggable:this.markers[d].draggable?this.markers[d].draggable:this.markers_conf.draggable,rich_marker:this.markers[d].rich_marker?this.markers[d].rich_marker:null,zindex:this.markers[d].zindex?this.markers[d].zindex:null,Lat:a,Lng:c,index:d}),this.createInfoWindow(this.markers[d]),this.createSidebar(this.markers[d]));return this.markers_conf.offset=this.markers.length},a.prototype.createImageAnchorPosition=function(a){return a===null?null:this.createPoint(a[0],a[1])},a.prototype.replaceMarkers=function(a){return this.clearMarkers(),this.markers=new Array,this.boundsObject=this.createLatLngBounds(),this.resetSidebarContent(),this.markers_conf.offset=0,this.addMarkers(a)},a.prototype.addMarkers=function(a){return this.markers=this.markers.concat(a),this.create_markers(),this.adjustMapToBounds()},a.prototype.createSidebar=function(a){var b,c,d,e,f;if(this.markers_conf.list_container)return f=document.getElementById(this.markers_conf.list_container),e=document.createElement("li"),b=document.createElement("a"),b.href="javascript:void(0);",d=a.sidebar!=null?a.sidebar:"Marker",b.innerHTML=d,c=this,b.onclick=this.sidebar_element_handler(c,a.serviceObject,"click"),e.appendChild(b),f.appendChild(e)},a.prototype.sidebar_element_handler=function(a,b,c){return function(){return a.map.panTo(b.position),google.maps.event.trigger(b,c)}},a.prototype.resetSidebarContent=function(){var a;if(this.markers_conf.list_container!==null)return a=document.getElementById(this.markers_conf.list_container),a.innerHTML=""},a.prototype.adjustMapToBounds=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;if(this.map_options.auto_adjust||this.map_options.bounds!==null){this.boundsObject=this.createLatLngBounds();if(this.map_options.auto_adjust){this.extendBoundsWithMarkers(),u=this.polylines;for(i=0,m=u.length;i<m;i++){g=u[i],h=g.serviceObject.latLngs.getArray()[0].getArray();for(j=0,n=h.length;j<n;j++)d=h[j],this.boundsObject.extend(d)}v=this.polygons;for(k=0,o=v.length;k<o;k++){e=v[k],f=e.serviceObject.latLngs.getArray()[0].getArray();for(l=0,p=f.length;l<p;l++)d=f[l],this.boundsObject.extend(d)}w=this.circles;for(s=0,q=w.length;s<q;s++)b=w[s],this.boundsObject.extend(b.serviceObject.getBounds().getNorthEast()),this.boundsObject.extend(b.serviceObject.getBounds().getSouthWest())}x=this.map_options.bounds;for(t=0,r=x.length;t<r;t++)a=x[t],a=this.createLatLng(a.lat,a.lng),this.boundsObject.extend(a);return this.map_options.auto_zoom?this.fitBounds():(c=this.boundsObject.getCenter(),this.map_options.center_latitude=c.lat(),this.map_options.center_longitude=c.lng(),this.serviceObject.setCenter(c))}},a.prototype.create_kml=function(){var a,b,c,d,e;d=this.kml,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a.serviceObject=this.createKmlLayer(a));return e},a.prototype.exists=function(a){return a!==""&&typeof a!="undefined"},a.prototype.randomize=function(a,b){var c,d,e,f;return e=this.markers_conf.max_random_distance*this.random(),f=this.markers_conf.max_random_distance*this.random(),c=parseFloat(a)+180/Math.PI*(f/6378137),d=parseFloat(b)+90/Math.PI*(e/6378137)/Math.cos(a),[c,d]},a.prototype.mergeObjectWithDefault=function(a,b){var c,d,e;c={};for(d in a)e=a[d],c[d]=e;for(d in b)e=b[d],c[d]==null&&(c[d]=e);return c},a.prototype.mergeWithDefault=function(a){var b,c;return b=this["default_"+a],c=this[a],this[a]=this.mergeObjectWithDefault(c,b),!0},a.prototype.random=function(){return Math.random()*2-1},a}()})).call(this);